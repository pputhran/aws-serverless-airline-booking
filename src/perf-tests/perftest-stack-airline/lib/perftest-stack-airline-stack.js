"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("@aws-cdk/core");
const ec2 = require("@aws-cdk/aws-ec2");
const ecs = require("@aws-cdk/aws-ecs");
const ecr = require("@aws-cdk/aws-ecr");
const aws_iam_1 = require("@aws-cdk/aws-iam");
const sfn = require("@aws-cdk/aws-stepfunctions");
const tasks = require("@aws-cdk/aws-stepfunctions-tasks");
const aws_logs_1 = require("@aws-cdk/aws-logs");
const aws_stepfunctions_1 = require("@aws-cdk/aws-stepfunctions");
const s3 = require("@aws-cdk/aws-s3");
const aws_events_1 = require("@aws-cdk/aws-events");
const lambda = require("@aws-cdk/aws-lambda");
const targets = require("@aws-cdk/aws-events-targets");
const ssm = require("@aws-cdk/aws-ssm");
const STACK_NAME = process.env.STACK_NAME;
const ROLE_NAME = `${STACK_NAME}-fargate-role`;
const VPC_NAME = `${STACK_NAME}-vpc`;
const CIDR_BLOCK = `198.162.0.0/24`;
const MAX_AZs = 2;
const ECR_GATLING_REPO_NAME = `${STACK_NAME}-gatling`;
const ECR_MOCKDATA_REPO_NAME = `${STACK_NAME}-mockdata`;
const ECS_CLUSTER = `${STACK_NAME}-cluster`;
const GATLING_FARGATE_TASK_DEF = `${STACK_NAME}-gatling-task-def`;
const MOCKDATA_FARGATE_TASK_DEF = `${STACK_NAME}-mockdata-task-def`;
const MEMORY_LIMIT = 2048;
const CPU = 1024;
const GATLING_CONTAINER_NAME = `${STACK_NAME}-gatling-container`;
const MOCKDATA_CONTAINER_NAME = `${STACK_NAME}-mockdata-container`;
const STATE_MACHINE_NAME = `loadtest-${STACK_NAME}`;
const S3_BUCKET_NAME = `${STACK_NAME}-loadtest`;
const BRANCH_NAME = process.env.AWS_BRANCH;
const FOLDERPATH = "./";
class PerftestStackAirlineStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        // retrieving all environment variables
        const AWS_DEFAULT_REGION = process.env.AWS_DEFAULT_REGION;
        const COGNITO_USER_POOL_ARN = process.env.COGNITO_USER_POOL_ARN || "not_defined";
        // const USER_POOL_ID = process.env.USER_POOL_ID || "not_defined"
        // const COGNITO_CLIENT_ID = process.env.COGNITO_CLIENT_ID || "not_defined"
        // const COGNITO_URL = `https://cognito-idp.${AWS_DEFAULT_REGION}.amazonaws.com/`
        // const APPSYNC_URL = process.env.APPSYNC_URL || "not_defined"
        // const API_URL = process.env.API_URL || "not_defined"
        // const GRAPHQL_API_ID = process.env.GRAPHQL_API_ID || "not_defined"
        const role = new aws_iam_1.Role(this, ROLE_NAME, {
            roleName: ROLE_NAME,
            assumedBy: new aws_iam_1.ServicePrincipal('ecs-tasks.amazonaws.com')
        });
        const bucket = new s3.Bucket(this, "s3bucket", {
            bucketName: S3_BUCKET_NAME
        });
        role.addToPolicy(new aws_iam_1.PolicyStatement({
            resources: [
                `${bucket.bucketArn}`,
                `${bucket.bucketArn}/*`
            ],
            actions: [
                's3:PutObject',
                's3:GetObjectAcl',
                's3:GetObject',
                's3:ListBucket',
                's3:PutObjectAcl',
                's3:DeleteObject'
            ]
        }));
        role.addToPolicy(new aws_iam_1.PolicyStatement({
            resources: [`${COGNITO_USER_POOL_ARN}`],
            actions: [
                'cognito-idp:AdminInitiateAuth',
                'cognito-idp:AdminCreateUser',
                'cognito-idp:AdminSetUserPassword',
                'cognito-idp:UpdateUserPoolClient',
                'cognito-idp:AdminDeleteUser'
            ]
        }));
        const vpc = new ec2.Vpc(this, VPC_NAME, {
            cidr: CIDR_BLOCK,
            maxAzs: MAX_AZs
        });
        const gatlingRepository = new ecr.Repository(this, ECR_GATLING_REPO_NAME, {
            repositoryName: ECR_GATLING_REPO_NAME
        });
        const mockDataRepository = new ecr.Repository(this, ECR_MOCKDATA_REPO_NAME, {
            repositoryName: ECR_MOCKDATA_REPO_NAME
        });
        const cluster = new ecs.Cluster(this, ECS_CLUSTER, {
            vpc: vpc,
            clusterName: ECS_CLUSTER
        });
        const gatlingTaskDefinition = new ecs.FargateTaskDefinition(this, GATLING_FARGATE_TASK_DEF, {
            family: GATLING_FARGATE_TASK_DEF,
            executionRole: role,
            taskRole: role,
            memoryLimitMiB: MEMORY_LIMIT,
            cpu: CPU
        });
        const mockDataTaskDefinition = new ecs.FargateTaskDefinition(this, MOCKDATA_FARGATE_TASK_DEF, {
            family: MOCKDATA_FARGATE_TASK_DEF,
            executionRole: role,
            taskRole: role,
            memoryLimitMiB: MEMORY_LIMIT,
            cpu: CPU
        });
        const gatlingLogging = new ecs.AwsLogDriver({
            logGroup: new aws_logs_1.LogGroup(this, GATLING_CONTAINER_NAME, {
                logGroupName: `/aws/ecs/${GATLING_CONTAINER_NAME}`,
                retention: aws_logs_1.RetentionDays.ONE_WEEK
            }),
            streamPrefix: "gatling"
        });
        const mockDatalogging = new ecs.AwsLogDriver({
            logGroup: new aws_logs_1.LogGroup(this, MOCKDATA_CONTAINER_NAME, {
                logGroupName: `/aws/ecs/${MOCKDATA_CONTAINER_NAME}`,
                retention: aws_logs_1.RetentionDays.ONE_WEEK
            }),
            streamPrefix: "mockdata"
        });
        const tokenCSV = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/loadtest/csv/token`);
        const userCSV = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/loadtest/csv/user`);
        const loadtestBucket = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/s3/loadtest/bucket`);
        const userPoolID = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/amplify/auth/userpool/id`);
        const cognitoClientID = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/amplify/auth/userpool/clientId`);
        const appsyncAPIKey = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/amplify/api/id`);
        const appsyncURL = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/amplify/api/url`);
        const cognitoURL = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/auth/userpool/url`);
        const apiURL = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/payment/api/charge/url`);
        const stripePublicKey = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/payment/stripe/publicKey`);
        const userCount = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/loadtest/usercount`);
        const duration = ssm.StringParameter.valueForStringParameter(this, `/${BRANCH_NAME}/service/loadtest/duration`);
        // Create container from local `Dockerfile` for Gatling
        const gatlingAppContainer = gatlingTaskDefinition.addContainer(GATLING_CONTAINER_NAME, {
            image: ecs.ContainerImage.fromEcrRepository(gatlingRepository),
            logging: gatlingLogging,
            environment: {
                "APPSYNC_URL": appsyncURL,
                "API_URL": apiURL,
                "COGNITO_URL": cognitoURL,
                "S3_BUCKET": loadtestBucket,
                "TOKEN_CSV": tokenCSV,
                "STRIPE_PUBLIC_KEY": stripePublicKey,
                "USER_COUNT": userCount,
                "DURATION": duration
            }
        });
        const mockDataAppContainer = mockDataTaskDefinition.addContainer(MOCKDATA_CONTAINER_NAME, {
            image: ecs.ContainerImage.fromEcrRepository(mockDataRepository),
            logging: mockDatalogging,
            environment: {
                "TOKEN_CSV": tokenCSV,
                "USER_CSV": userCSV,
                "AWS_REGION": `${AWS_DEFAULT_REGION}`,
                "S3_BUCKET": loadtestBucket,
                "USER_POOL_ID": userPoolID,
                "COGNITO_CLIENT_ID": cognitoClientID,
                "FOLDERPATH": FOLDERPATH,
                "APPSYNC_API_KEY": appsyncAPIKey,
                "APPSYNC_URL": appsyncURL
            }
        });
        // Step function for setting the load test
        const setupUsers = new sfn.Task(this, "Setup Users", {
            task: new tasks.RunEcsFargateTask({
                cluster,
                taskDefinition: mockDataTaskDefinition,
                assignPublicIp: true,
                containerOverrides: [{
                        containerName: mockDataAppContainer.containerName,
                        command: aws_stepfunctions_1.Data.listAt('$.commands'),
                        environment: [
                            {
                                name: 'setup-users',
                                value: aws_stepfunctions_1.Context.taskToken
                            }
                        ]
                    }],
                integrationPattern: aws_stepfunctions_1.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN
            })
        });
        const loadFlights = new sfn.Task(this, "Load Flights", {
            task: new tasks.RunEcsFargateTask({
                cluster,
                taskDefinition: mockDataTaskDefinition,
                assignPublicIp: true,
                containerOverrides: [{
                        containerName: mockDataAppContainer.containerName,
                        command: aws_stepfunctions_1.Data.listAt('$.commands'),
                        environment: [
                            {
                                name: 'load-flights',
                                value: aws_stepfunctions_1.Context.taskToken
                            }
                        ]
                    }],
                integrationPattern: aws_stepfunctions_1.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN
            })
        });
        const runGatling = new sfn.Task(this, "Run Gatling", {
            task: new tasks.RunEcsFargateTask({
                cluster,
                taskDefinition: gatlingTaskDefinition,
                assignPublicIp: true,
                containerOverrides: [{
                        containerName: gatlingAppContainer.containerName,
                        command: aws_stepfunctions_1.Data.listAt('$.commands'),
                        environment: [
                            {
                                name: 'run-gatling',
                                value: aws_stepfunctions_1.Context.taskToken
                            }
                        ]
                    }],
                integrationPattern: aws_stepfunctions_1.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN
            })
        });
        const consolidateReport = new sfn.Task(this, "Consolidate Report", {
            task: new tasks.RunEcsFargateTask({
                cluster,
                taskDefinition: gatlingTaskDefinition,
                assignPublicIp: true,
                containerOverrides: [{
                        containerName: gatlingAppContainer.containerName,
                        command: aws_stepfunctions_1.Data.listAt('$.commands'),
                        environment: [
                            {
                                name: 'consolidate-report',
                                value: aws_stepfunctions_1.Context.taskToken
                            }
                        ]
                    }],
                integrationPattern: aws_stepfunctions_1.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN
            })
        });
        const cleanUp = new sfn.Task(this, "Clean Up", {
            task: new tasks.RunEcsFargateTask({
                cluster,
                taskDefinition: mockDataTaskDefinition,
                assignPublicIp: true,
                containerOverrides: [{
                        containerName: mockDataAppContainer.containerName,
                        command: aws_stepfunctions_1.Data.listAt('$.commands'),
                        environment: [
                            {
                                name: 'clean-up',
                                value: aws_stepfunctions_1.Context.taskToken
                            }
                        ]
                    }],
                integrationPattern: aws_stepfunctions_1.ServiceIntegrationPattern.WAIT_FOR_TASK_TOKEN
            })
        });
        const stepfuncDefinition = setupUsers
            .next(loadFlights)
            .next(runGatling)
            .next(consolidateReport)
            .next(cleanUp);
        const loadtestsfn = new sfn.StateMachine(this, STATE_MACHINE_NAME, {
            stateMachineName: STATE_MACHINE_NAME,
            definition: stepfuncDefinition
        });
        const ecsLambda = new lambda.Function(this, "ecstasklambda", {
            runtime: lambda.Runtime.NODEJS_10_X,
            handler: "index.handler",
            code: new lambda.AssetCode("lambda"),
            functionName: `${STACK_NAME}-ecs-task-change`
        });
        ecsLambda.addToRolePolicy(new aws_iam_1.PolicyStatement({
            actions: ["states:SendTaskSuccess"],
            resources: [loadtestsfn.stateMachineArn]
        }));
        const cwRule = new aws_events_1.Rule(this, "cw-rule", {
            description: "Rule that looks at ECS Task change state and triggers Lambda function",
            enabled: true,
            ruleName: "ECS-task-change-cdk",
            targets: []
        });
        cwRule.addEventPattern({
            source: ['aws.ecs'],
            detailType: ["ECS Task State Change"],
            detail: {
                clusterArn: [cluster.clusterArn],
                lastStatus: ["STOPPED"]
            }
        });
        cwRule.addTarget(new targets.LambdaFunction(ecsLambda));
    }
}
exports.PerftestStackAirlineStack = PerftestStackAirlineStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVyZnRlc3Qtc3RhY2stYWlybGluZS1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBlcmZ0ZXN0LXN0YWNrLWFpcmxpbmUtc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxxQ0FBc0M7QUFDdEMsd0NBQXdDO0FBQ3hDLHdDQUF3QztBQUN4Qyx3Q0FBd0M7QUFDeEMsOENBQTJFO0FBQzNFLGtEQUFtRDtBQUNuRCwwREFBMkQ7QUFDM0QsZ0RBQTREO0FBQzVELGtFQUFzRjtBQUN0RixzQ0FBdUM7QUFDdkMsb0RBQTJDO0FBQzNDLDhDQUE4QztBQUM5Qyx1REFBdUQ7QUFDdkQsd0NBQXlDO0FBRXpDLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDO0FBQzFDLE1BQU0sU0FBUyxHQUFHLEdBQUcsVUFBVSxlQUFlLENBQUM7QUFDL0MsTUFBTSxRQUFRLEdBQUcsR0FBRyxVQUFVLE1BQU0sQ0FBQztBQUNyQyxNQUFNLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQztBQUNwQyxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUE7QUFDakIsTUFBTSxxQkFBcUIsR0FBRyxHQUFHLFVBQVUsVUFBVSxDQUFBO0FBQ3JELE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxVQUFVLFdBQVcsQ0FBQTtBQUN2RCxNQUFNLFdBQVcsR0FBRyxHQUFHLFVBQVUsVUFBVSxDQUFBO0FBQzNDLE1BQU0sd0JBQXdCLEdBQUcsR0FBRyxVQUFVLG1CQUFtQixDQUFBO0FBQ2pFLE1BQU0seUJBQXlCLEdBQUcsR0FBRyxVQUFVLG9CQUFvQixDQUFBO0FBQ25FLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQTtBQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUE7QUFDaEIsTUFBTSxzQkFBc0IsR0FBRyxHQUFHLFVBQVUsb0JBQW9CLENBQUE7QUFDaEUsTUFBTSx1QkFBdUIsR0FBRyxHQUFHLFVBQVUscUJBQXFCLENBQUE7QUFDbEUsTUFBTSxr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LFFBQVEsRUFBRSxxQkFBcUI7WUFDL0IsT0FBTyxFQUFFLEVBQ1I7U0FDRixDQUFDLENBQUE7UUFFRixNQUFNLENBQUMsZUFBZSxDQUFDO1lBQ3JCLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNuQixVQUFVLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQztZQUNyQyxNQUFNLEVBQUU7Z0JBQ04sVUFBVSxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztnQkFDaEMsVUFBVSxFQUFFLENBQUMsU0FBUyxDQUFDO2FBQ3hCO1NBQ0YsQ0FBQyxDQUFBO1FBRUYsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtJQUV6RCxDQUFDO0NBQ0Y7QUE1UkQsOERBNFJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNkayA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2NvcmUnKTtcbmltcG9ydCBlYzIgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtZWMyJylcbmltcG9ydCBlY3MgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtZWNzJylcbmltcG9ydCBlY3IgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtZWNyJylcbmltcG9ydCB7IFJvbGUsIFNlcnZpY2VQcmluY2lwYWwsIFBvbGljeVN0YXRlbWVudCB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IHNmbiA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1zdGVwZnVuY3Rpb25zJyk7XG5pbXBvcnQgdGFza3MgPSByZXF1aXJlKCdAYXdzLWNkay9hd3Mtc3RlcGZ1bmN0aW9ucy10YXNrcycpO1xuaW1wb3J0IHsgTG9nR3JvdXAsIFJldGVudGlvbkRheXMgfSBmcm9tICdAYXdzLWNkay9hd3MtbG9ncyc7XG5pbXBvcnQgeyBEYXRhLCBTZXJ2aWNlSW50ZWdyYXRpb25QYXR0ZXJuLCBDb250ZXh0IH0gZnJvbSAnQGF3cy1jZGsvYXdzLXN0ZXBmdW5jdGlvbnMnO1xuaW1wb3J0IHMzID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLXMzJyk7XG5pbXBvcnQgeyBSdWxlIH0gZnJvbSAnQGF3cy1jZGsvYXdzLWV2ZW50cyc7XG5pbXBvcnQgbGFtYmRhID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLWxhbWJkYScpXG5pbXBvcnQgdGFyZ2V0cyA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1ldmVudHMtdGFyZ2V0cycpXG5pbXBvcnQgc3NtID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLXNzbScpO1xuXG5jb25zdCBTVEFDS19OQU1FID0gcHJvY2Vzcy5lbnYuU1RBQ0tfTkFNRTtcbmNvbnN0IFJPTEVfTkFNRSA9IGAke1NUQUNLX05BTUV9LWZhcmdhdGUtcm9sZWA7XG5jb25zdCBWUENfTkFNRSA9IGAke1NUQUNLX05BTUV9LXZwY2A7XG5jb25zdCBDSURSX0JMT0NLID0gYDE5OC4xNjIuMC4wLzI0YDtcbmNvbnN0IE1BWF9BWnMgPSAyXG5jb25zdCBFQ1JfR0FUTElOR19SRVBPX05BTUUgPSBgJHtTVEFDS19OQU1FfS1nYXRsaW5nYFxuY29uc3QgRUNSX01PQ0tEQVRBX1JFUE9fTkFNRSA9IGAke1NUQUNLX05BTUV9LW1vY2tkYXRhYFxuY29uc3QgRUNTX0NMVVNURVIgPSBgJHtTVEFDS19OQU1FfS1jbHVzdGVyYFxuY29uc3QgR0FUTElOR19GQVJHQVRFX1RBU0tfREVGID0gYCR7U1RBQ0tfTkFNRX0tZ2F0bGluZy10YXNrLWRlZmBcbmNvbnN0IE1PQ0tEQVRBX0ZBUkdBVEVfVEFTS19ERUYgPSBgJHtTVEFDS19OQU1FfS1tb2NrZGF0YS10YXNrLWRlZmBcbmNvbnN0IE1FTU9SWV9MSU1JVCA9IDIwNDhcbmNvbnN0IENQVSA9IDEwMjRcbmNvbnN0IEdBVExJTkdfQ09OVEFJTkVSX05BTUUgPSBgJHtTVEFDS19OQU1FfS1nYXRsaW5nLWNvbnRhaW5lcmBcbmNvbnN0IE1PQ0tEQVRBX0NPTlRBSU5FUl9OQU1FID0gYCR7U1RBQ0tfTkFNRX0tbW9ja2RhdGEtY29udGFpbmVyYFxuY29uc3QgU1RBVEVfTUFDSElORV9OQU1FID0gYGxvYWR0ZXN0LSR7U1RBQ0tfTkFNRX1gXG5jb25zdCBTM19CVUNLRVRfTkFNRSA9IGAke1NUQUNLX05BTUV9LWxvYWR0ZXN0YFxuY29uc3QgQlJBTkNIX05BTUUgPSBwcm9jZXNzLmVudi5BV1NfQlJBTkNIXG5jb25zdCBGT0xERVJQQVRIID0gXCIuL1wiXG5cbmV4cG9ydCBjbGFzcyBQZXJmdGVzdFN0YWNrQWlybGluZVN0YWNrIGV4dGVuZHMgY2RrLlN0YWNrIHtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IGNkay5BcHAsIGlkOiBzdHJpbmcsIHByb3BzPzogY2RrLlN0YWNrUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcblxuICAgIC8vIHJldHJpZXZpbmcgYWxsIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgIGNvbnN0IEFXU19ERUZBVUxUX1JFR0lPTiA9IHByb2Nlc3MuZW52LkFXU19ERUZBVUxUX1JFR0lPTlxuICAgIGNvbnN0IENPR05JVE9fVVNFUl9QT09MX0FSTiA9IHByb2Nlc3MuZW52LkNPR05JVE9fVVNFUl9QT09MX0FSTiB8fCBcIm5vdF9kZWZpbmVkXCJcbiAgICAvLyBjb25zdCBVU0VSX1BPT0xfSUQgPSBwcm9jZXNzLmVudi5VU0VSX1BPT0xfSUQgfHwgXCJub3RfZGVmaW5lZFwiXG4gICAgLy8gY29uc3QgQ09HTklUT19DTElFTlRfSUQgPSBwcm9jZXNzLmVudi5DT0dOSVRPX0NMSUVOVF9JRCB8fCBcIm5vdF9kZWZpbmVkXCJcbiAgICAvLyBjb25zdCBDT0dOSVRPX1VSTCA9IGBodHRwczovL2NvZ25pdG8taWRwLiR7QVdTX0RFRkFVTFRfUkVHSU9OfS5hbWF6b25hd3MuY29tL2BcbiAgICAvLyBjb25zdCBBUFBTWU5DX1VSTCA9IHByb2Nlc3MuZW52LkFQUFNZTkNfVVJMIHx8IFwibm90X2RlZmluZWRcIlxuICAgIC8vIGNvbnN0IEFQSV9VUkwgPSBwcm9jZXNzLmVudi5BUElfVVJMIHx8IFwibm90X2RlZmluZWRcIlxuICAgIC8vIGNvbnN0IEdSQVBIUUxfQVBJX0lEID0gcHJvY2Vzcy5lbnYuR1JBUEhRTF9BUElfSUQgfHwgXCJub3RfZGVmaW5lZFwiXG5cbiAgICBjb25zdCByb2xlID0gbmV3IFJvbGUodGhpcywgUk9MRV9OQU1FLCB7XG4gICAgICByb2xlTmFtZTogUk9MRV9OQU1FLFxuICAgICAgYXNzdW1lZEJ5OiBuZXcgU2VydmljZVByaW5jaXBhbCgnZWNzLXRhc2tzLmFtYXpvbmF3cy5jb20nKVxuICAgIH0pXG5cbiAgICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHRoaXMsIFwiczNidWNrZXRcIiwge1xuICAgICAgYnVja2V0TmFtZTogUzNfQlVDS0VUX05BTUVcbiAgICB9KVxuXG4gICAgcm9sZS5hZGRUb1BvbGljeShuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgIHJlc291cmNlczogW1xuICAgICAgICBgJHtidWNrZXQuYnVja2V0QXJufWAsXG4gICAgICAgIGAke2J1Y2tldC5idWNrZXRBcm59LypgXG4gICAgICBdLFxuICAgICAgYWN0aW9uczogW1xuICAgICAgICAnczM6UHV0T2JqZWN0JyxcbiAgICAgICAgJ3MzOkdldE9iamVjdEFjbCcsXG4gICAgICAgICdzMzpHZXRPYmplY3QnLFxuICAgICAgICAnczM6TGlzdEJ1Y2tldCcsXG4gICAgICAgICdzMzpQdXRPYmplY3RBY2wnLFxuICAgICAgICAnczM6RGVsZXRlT2JqZWN0J1xuICAgICAgXVxuICAgIH0pKVxuXG4gICAgcm9sZS5hZGRUb1BvbGljeShuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgIHJlc291cmNlczogW2Ake0NPR05JVE9fVVNFUl9QT09MX0FSTn1gXSxcbiAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgJ2NvZ25pdG8taWRwOkFkbWluSW5pdGlhdGVBdXRoJyxcbiAgICAgICAgJ2NvZ25pdG8taWRwOkFkbWluQ3JlYXRlVXNlcicsXG4gICAgICAgICdjb2duaXRvLWlkcDpBZG1pblNldFVzZXJQYXNzd29yZCcsXG4gICAgICAgICdjb2duaXRvLWlkcDpVcGRhdGVVc2VyUG9vbENsaWVudCcsXG4gICAgICAgICdjb2duaXRvLWlkcDpBZG1pbkRlbGV0ZVVzZXInXG4gICAgICBdXG4gICAgfSkpXG5cbiAgICBjb25zdCB2cGMgPSBuZXcgZWMyLlZwYyh0aGlzLCBWUENfTkFNRSwge1xuICAgICAgY2lkcjogQ0lEUl9CTE9DSyxcbiAgICAgIG1heEF6czogTUFYX0Fac1xuICAgIH0pXG5cblxuICAgIGNvbnN0IGdhdGxpbmdSZXBvc2l0b3J5ID0gbmV3IGVjci5SZXBvc2l0b3J5KHRoaXMsIEVDUl9HQVRMSU5HX1JFUE9fTkFNRSwge1xuICAgICAgcmVwb3NpdG9yeU5hbWU6IEVDUl9HQVRMSU5HX1JFUE9fTkFNRVxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9ja0RhdGFSZXBvc2l0b3J5ID0gbmV3IGVjci5SZXBvc2l0b3J5KHRoaXMsIEVDUl9NT0NLREFUQV9SRVBPX05BTUUsIHtcbiAgICAgIHJlcG9zaXRvcnlOYW1lOiBFQ1JfTU9DS0RBVEFfUkVQT19OQU1FXG4gICAgfSk7XG5cbiAgICBjb25zdCBjbHVzdGVyID0gbmV3IGVjcy5DbHVzdGVyKHRoaXMsIEVDU19DTFVTVEVSLCB7XG4gICAgICB2cGM6IHZwYyxcbiAgICAgIGNsdXN0ZXJOYW1lOiBFQ1NfQ0xVU1RFUlxuICAgIH0pO1xuXG4gICAgY29uc3QgZ2F0bGluZ1Rhc2tEZWZpbml0aW9uID0gbmV3IGVjcy5GYXJnYXRlVGFza0RlZmluaXRpb24odGhpcywgR0FUTElOR19GQVJHQVRFX1RBU0tfREVGLCB7XG4gICAgICBmYW1pbHk6IEdBVExJTkdfRkFSR0FURV9UQVNLX0RFRixcbiAgICAgIGV4ZWN1dGlvblJvbGU6IHJvbGUsXG4gICAgICB0YXNrUm9sZTogcm9sZSxcbiAgICAgIG1lbW9yeUxpbWl0TWlCOiBNRU1PUllfTElNSVQsXG4gICAgICBjcHU6IENQVVxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9ja0RhdGFUYXNrRGVmaW5pdGlvbiA9IG5ldyBlY3MuRmFyZ2F0ZVRhc2tEZWZpbml0aW9uKHRoaXMsIE1PQ0tEQVRBX0ZBUkdBVEVfVEFTS19ERUYsIHtcbiAgICAgIGZhbWlseTogTU9DS0RBVEFfRkFSR0FURV9UQVNLX0RFRixcbiAgICAgIGV4ZWN1dGlvblJvbGU6IHJvbGUsXG4gICAgICB0YXNrUm9sZTogcm9sZSxcbiAgICAgIG1lbW9yeUxpbWl0TWlCOiBNRU1PUllfTElNSVQsXG4gICAgICBjcHU6IENQVVxuICAgIH0pO1xuXG4gICAgY29uc3QgZ2F0bGluZ0xvZ2dpbmcgPSBuZXcgZWNzLkF3c0xvZ0RyaXZlcih7XG4gICAgICBsb2dHcm91cDogbmV3IExvZ0dyb3VwKHRoaXMsIEdBVExJTkdfQ09OVEFJTkVSX05BTUUsIHtcbiAgICAgICAgbG9nR3JvdXBOYW1lOiBgL2F3cy9lY3MvJHtHQVRMSU5HX0NPTlRBSU5FUl9OQU1FfWAsXG4gICAgICAgIHJldGVudGlvbjogUmV0ZW50aW9uRGF5cy5PTkVfV0VFS1xuICAgICAgfSksXG4gICAgICBzdHJlYW1QcmVmaXg6IFwiZ2F0bGluZ1wiXG4gICAgfSlcblxuICAgIGNvbnN0IG1vY2tEYXRhbG9nZ2luZyA9IG5ldyBlY3MuQXdzTG9nRHJpdmVyKHtcbiAgICAgIGxvZ0dyb3VwOiBuZXcgTG9nR3JvdXAodGhpcywgTU9DS0RBVEFfQ09OVEFJTkVSX05BTUUsIHtcbiAgICAgICAgbG9nR3JvdXBOYW1lOiBgL2F3cy9lY3MvJHtNT0NLREFUQV9DT05UQUlORVJfTkFNRX1gLFxuICAgICAgICByZXRlbnRpb246IFJldGVudGlvbkRheXMuT05FX1dFRUtcbiAgICAgIH0pLFxuICAgICAgc3RyZWFtUHJlZml4OiBcIm1vY2tkYXRhXCJcbiAgICB9KVxuXG4gICAgY29uc3QgdG9rZW5DU1YgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9sb2FkdGVzdC9jc3YvdG9rZW5gKTtcbiAgICBjb25zdCB1c2VyQ1NWID0gc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcih0aGlzLCBgLyR7QlJBTkNIX05BTUV9L3NlcnZpY2UvbG9hZHRlc3QvY3N2L3VzZXJgKTtcbiAgICBjb25zdCBsb2FkdGVzdEJ1Y2tldCA9IHNzbS5TdHJpbmdQYXJhbWV0ZXIudmFsdWVGb3JTdHJpbmdQYXJhbWV0ZXIodGhpcywgYC8ke0JSQU5DSF9OQU1FfS9zZXJ2aWNlL3MzL2xvYWR0ZXN0L2J1Y2tldGApO1xuICAgIGNvbnN0IHVzZXJQb29sSUQgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9hbXBsaWZ5L2F1dGgvdXNlcnBvb2wvaWRgKTtcbiAgICBjb25zdCBjb2duaXRvQ2xpZW50SUQgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9hbXBsaWZ5L2F1dGgvdXNlcnBvb2wvY2xpZW50SWRgKTtcbiAgICBjb25zdCBhcHBzeW5jQVBJS2V5ID0gc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcih0aGlzLCBgLyR7QlJBTkNIX05BTUV9L3NlcnZpY2UvYW1wbGlmeS9hcGkvaWRgKVxuICAgIGNvbnN0IGFwcHN5bmNVUkwgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9hbXBsaWZ5L2FwaS91cmxgKVxuICAgIGNvbnN0IGNvZ25pdG9VUkwgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9hdXRoL3VzZXJwb29sL3VybGApXG4gICAgY29uc3QgYXBpVVJMID0gc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcih0aGlzLCBgLyR7QlJBTkNIX05BTUV9L3NlcnZpY2UvcGF5bWVudC9hcGkvY2hhcmdlL3VybGApXG4gICAgY29uc3Qgc3RyaXBlUHVibGljS2V5ID0gc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcih0aGlzLCBgLyR7QlJBTkNIX05BTUV9L3NlcnZpY2UvcGF5bWVudC9zdHJpcGUvcHVibGljS2V5YClcbiAgICBjb25zdCB1c2VyQ291bnQgPSBzc20uU3RyaW5nUGFyYW1ldGVyLnZhbHVlRm9yU3RyaW5nUGFyYW1ldGVyKHRoaXMsIGAvJHtCUkFOQ0hfTkFNRX0vc2VydmljZS9sb2FkdGVzdC91c2VyY291bnRgKVxuICAgIGNvbnN0IGR1cmF0aW9uID0gc3NtLlN0cmluZ1BhcmFtZXRlci52YWx1ZUZvclN0cmluZ1BhcmFtZXRlcih0aGlzLCBgLyR7QlJBTkNIX05BTUV9L3NlcnZpY2UvbG9hZHRlc3QvZHVyYXRpb25gKVxuXG4gICAgLy8gQ3JlYXRlIGNvbnRhaW5lciBmcm9tIGxvY2FsIGBEb2NrZXJmaWxlYCBmb3IgR2F0bGluZ1xuICAgIGNvbnN0IGdhdGxpbmdBcHBDb250YWluZXIgPSBnYXRsaW5nVGFza0RlZmluaXRpb24uYWRkQ29udGFpbmVyKEdBVExJTkdfQ09OVEFJTkVSX05BTUUsIHtcbiAgICAgIGltYWdlOiBlY3MuQ29udGFpbmVySW1hZ2UuZnJvbUVjclJlcG9zaXRvcnkoZ2F0bGluZ1JlcG9zaXRvcnkpLFxuICAgICAgbG9nZ2luZzogZ2F0bGluZ0xvZ2dpbmcsXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBcIkFQUFNZTkNfVVJMXCI6IGFwcHN5bmNVUkwsXG4gICAgICAgIFwiQVBJX1VSTFwiOiBhcGlVUkwsXG4gICAgICAgIFwiQ09HTklUT19VUkxcIjogY29nbml0b1VSTCxcbiAgICAgICAgXCJTM19CVUNLRVRcIjogbG9hZHRlc3RCdWNrZXQsXG4gICAgICAgIFwiVE9LRU5fQ1NWXCI6IHRva2VuQ1NWLFxuICAgICAgICBcIlNUUklQRV9QVUJMSUNfS0VZXCI6IHN0cmlwZVB1YmxpY0tleSxcbiAgICAgICAgXCJVU0VSX0NPVU5UXCI6IHVzZXJDb3VudCxcbiAgICAgICAgXCJEVVJBVElPTlwiOiBkdXJhdGlvblxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9ja0RhdGFBcHBDb250YWluZXIgPSBtb2NrRGF0YVRhc2tEZWZpbml0aW9uLmFkZENvbnRhaW5lcihNT0NLREFUQV9DT05UQUlORVJfTkFNRSwge1xuICAgICAgaW1hZ2U6IGVjcy5Db250YWluZXJJbWFnZS5mcm9tRWNyUmVwb3NpdG9yeShtb2NrRGF0YVJlcG9zaXRvcnkpLFxuICAgICAgbG9nZ2luZzogbW9ja0RhdGFsb2dnaW5nLFxuICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgXCJUT0tFTl9DU1ZcIjogdG9rZW5DU1YsXG4gICAgICAgIFwiVVNFUl9DU1ZcIjogdXNlckNTVixcbiAgICAgICAgXCJBV1NfUkVHSU9OXCI6IGAke0FXU19ERUZBVUxUX1JFR0lPTn1gLFxuICAgICAgICBcIlMzX0JVQ0tFVFwiOiBsb2FkdGVzdEJ1Y2tldCxcbiAgICAgICAgXCJVU0VSX1BPT0xfSURcIjogdXNlclBvb2xJRCxcbiAgICAgICAgXCJDT0dOSVRPX0NMSUVOVF9JRFwiOiBjb2duaXRvQ2xpZW50SUQsXG4gICAgICAgIFwiRk9MREVSUEFUSFwiOiBGT0xERVJQQVRILFxuICAgICAgICBcIkFQUFNZTkNfQVBJX0tFWVwiOiBhcHBzeW5jQVBJS2V5LFxuICAgICAgICBcIkFQUFNZTkNfVVJMXCI6IGFwcHN5bmNVUkxcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFN0ZXAgZnVuY3Rpb24gZm9yIHNldHRpbmcgdGhlIGxvYWQgdGVzdFxuICAgIGNvbnN0IHNldHVwVXNlcnMgPSBuZXcgc2ZuLlRhc2sodGhpcywgXCJTZXR1cCBVc2Vyc1wiLCB7XG4gICAgICB0YXNrOiBuZXcgdGFza3MuUnVuRWNzRmFyZ2F0ZVRhc2soe1xuICAgICAgICBjbHVzdGVyLFxuICAgICAgICB0YXNrRGVmaW5pdGlvbjogbW9ja0RhdGFUYXNrRGVmaW5pdGlvbixcbiAgICAgICAgYXNzaWduUHVibGljSXA6IHRydWUsXG4gICAgICAgIGNvbnRhaW5lck92ZXJyaWRlczogW3tcbiAgICAgICAgICBjb250YWluZXJOYW1lOiBtb2NrRGF0YUFwcENvbnRhaW5lci5jb250YWluZXJOYW1lLFxuICAgICAgICAgIGNvbW1hbmQ6IERhdGEubGlzdEF0KCckLmNvbW1hbmRzJyksXG4gICAgICAgICAgZW52aXJvbm1lbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbmFtZTogJ3NldHVwLXVzZXJzJyxcbiAgICAgICAgICAgICAgdmFsdWU6IENvbnRleHQudGFza1Rva2VuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XSxcbiAgICAgICAgaW50ZWdyYXRpb25QYXR0ZXJuOiBTZXJ2aWNlSW50ZWdyYXRpb25QYXR0ZXJuLldBSVRfRk9SX1RBU0tfVE9LRU5cbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGNvbnN0IGxvYWRGbGlnaHRzID0gbmV3IHNmbi5UYXNrKHRoaXMsIFwiTG9hZCBGbGlnaHRzXCIsIHtcbiAgICAgIHRhc2s6IG5ldyB0YXNrcy5SdW5FY3NGYXJnYXRlVGFzayh7XG4gICAgICAgIGNsdXN0ZXIsXG4gICAgICAgIHRhc2tEZWZpbml0aW9uOiBtb2NrRGF0YVRhc2tEZWZpbml0aW9uLFxuICAgICAgICBhc3NpZ25QdWJsaWNJcDogdHJ1ZSxcbiAgICAgICAgY29udGFpbmVyT3ZlcnJpZGVzOiBbe1xuICAgICAgICAgIGNvbnRhaW5lck5hbWU6IG1vY2tEYXRhQXBwQ29udGFpbmVyLmNvbnRhaW5lck5hbWUsXG4gICAgICAgICAgY29tbWFuZDogRGF0YS5saXN0QXQoJyQuY29tbWFuZHMnKSxcbiAgICAgICAgICBlbnZpcm9ubWVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBuYW1lOiAnbG9hZC1mbGlnaHRzJyxcbiAgICAgICAgICAgICAgdmFsdWU6IENvbnRleHQudGFza1Rva2VuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XSxcbiAgICAgICAgaW50ZWdyYXRpb25QYXR0ZXJuOiBTZXJ2aWNlSW50ZWdyYXRpb25QYXR0ZXJuLldBSVRfRk9SX1RBU0tfVE9LRU5cbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGNvbnN0IHJ1bkdhdGxpbmcgPSBuZXcgc2ZuLlRhc2sodGhpcywgXCJSdW4gR2F0bGluZ1wiLCB7XG4gICAgICB0YXNrOiBuZXcgdGFza3MuUnVuRWNzRmFyZ2F0ZVRhc2soe1xuICAgICAgICBjbHVzdGVyLFxuICAgICAgICB0YXNrRGVmaW5pdGlvbjogZ2F0bGluZ1Rhc2tEZWZpbml0aW9uLFxuICAgICAgICBhc3NpZ25QdWJsaWNJcDogdHJ1ZSxcbiAgICAgICAgY29udGFpbmVyT3ZlcnJpZGVzOiBbe1xuICAgICAgICAgIGNvbnRhaW5lck5hbWU6IGdhdGxpbmdBcHBDb250YWluZXIuY29udGFpbmVyTmFtZSxcbiAgICAgICAgICBjb21tYW5kOiBEYXRhLmxpc3RBdCgnJC5jb21tYW5kcycpLFxuICAgICAgICAgIGVudmlyb25tZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdydW4tZ2F0bGluZycsXG4gICAgICAgICAgICAgIHZhbHVlOiBDb250ZXh0LnRhc2tUb2tlblxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfV0sXG4gICAgICAgIGludGVncmF0aW9uUGF0dGVybjogU2VydmljZUludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBjb25zdCBjb25zb2xpZGF0ZVJlcG9ydCA9IG5ldyBzZm4uVGFzayh0aGlzLCBcIkNvbnNvbGlkYXRlIFJlcG9ydFwiLCB7XG4gICAgICB0YXNrOiBuZXcgdGFza3MuUnVuRWNzRmFyZ2F0ZVRhc2soe1xuICAgICAgICBjbHVzdGVyLFxuICAgICAgICB0YXNrRGVmaW5pdGlvbjogZ2F0bGluZ1Rhc2tEZWZpbml0aW9uLFxuICAgICAgICBhc3NpZ25QdWJsaWNJcDogdHJ1ZSxcbiAgICAgICAgY29udGFpbmVyT3ZlcnJpZGVzOiBbe1xuICAgICAgICAgIGNvbnRhaW5lck5hbWU6IGdhdGxpbmdBcHBDb250YWluZXIuY29udGFpbmVyTmFtZSxcbiAgICAgICAgICBjb21tYW5kOiBEYXRhLmxpc3RBdCgnJC5jb21tYW5kcycpLFxuICAgICAgICAgIGVudmlyb25tZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG5hbWU6ICdjb25zb2xpZGF0ZS1yZXBvcnQnLFxuICAgICAgICAgICAgICB2YWx1ZTogQ29udGV4dC50YXNrVG9rZW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1dLFxuICAgICAgICBpbnRlZ3JhdGlvblBhdHRlcm46IFNlcnZpY2VJbnRlZ3JhdGlvblBhdHRlcm4uV0FJVF9GT1JfVEFTS19UT0tFTlxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgY29uc3QgY2xlYW5VcCA9IG5ldyBzZm4uVGFzayh0aGlzLCBcIkNsZWFuIFVwXCIsIHtcbiAgICAgIHRhc2s6IG5ldyB0YXNrcy5SdW5FY3NGYXJnYXRlVGFzayh7XG4gICAgICAgIGNsdXN0ZXIsXG4gICAgICAgIHRhc2tEZWZpbml0aW9uOiBtb2NrRGF0YVRhc2tEZWZpbml0aW9uLFxuICAgICAgICBhc3NpZ25QdWJsaWNJcDogdHJ1ZSxcbiAgICAgICAgY29udGFpbmVyT3ZlcnJpZGVzOiBbe1xuICAgICAgICAgIGNvbnRhaW5lck5hbWU6IG1vY2tEYXRhQXBwQ29udGFpbmVyLmNvbnRhaW5lck5hbWUsXG4gICAgICAgICAgY29tbWFuZDogRGF0YS5saXN0QXQoJyQuY29tbWFuZHMnKSxcbiAgICAgICAgICBlbnZpcm9ubWVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBuYW1lOiAnY2xlYW4tdXAnLFxuICAgICAgICAgICAgICB2YWx1ZTogQ29udGV4dC50YXNrVG9rZW5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1dLFxuICAgICAgICBpbnRlZ3JhdGlvblBhdHRlcm46IFNlcnZpY2VJbnRlZ3JhdGlvblBhdHRlcm4uV0FJVF9GT1JfVEFTS19UT0tFTlxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgY29uc3Qgc3RlcGZ1bmNEZWZpbml0aW9uID0gc2V0dXBVc2Vyc1xuICAgICAgLm5leHQobG9hZEZsaWdodHMpXG4gICAgICAubmV4dChydW5HYXRsaW5nKVxuICAgICAgLm5leHQoY29uc29saWRhdGVSZXBvcnQpXG4gICAgICAubmV4dChjbGVhblVwKVxuXG4gICAgY29uc3QgbG9hZHRlc3RzZm4gPSBuZXcgc2ZuLlN0YXRlTWFjaGluZSh0aGlzLCBTVEFURV9NQUNISU5FX05BTUUsIHtcbiAgICAgIHN0YXRlTWFjaGluZU5hbWU6IFNUQVRFX01BQ0hJTkVfTkFNRSxcbiAgICAgIGRlZmluaXRpb246IHN0ZXBmdW5jRGVmaW5pdGlvblxuICAgIH0pXG5cbiAgICBjb25zdCBlY3NMYW1iZGEgPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHRoaXMsIFwiZWNzdGFza2xhbWJkYVwiLCB7XG4gICAgICBydW50aW1lOiBsYW1iZGEuUnVudGltZS5OT0RFSlNfMTBfWCxcbiAgICAgIGhhbmRsZXI6IFwiaW5kZXguaGFuZGxlclwiLFxuICAgICAgY29kZTogbmV3IGxhbWJkYS5Bc3NldENvZGUoXCJsYW1iZGFcIiksXG4gICAgICBmdW5jdGlvbk5hbWU6IGAke1NUQUNLX05BTUV9LWVjcy10YXNrLWNoYW5nZWBcbiAgICB9KVxuXG4gICAgZWNzTGFtYmRhLmFkZFRvUm9sZVBvbGljeShuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgIGFjdGlvbnM6IFtcInN0YXRlczpTZW5kVGFza1N1Y2Nlc3NcIl0sXG4gICAgICByZXNvdXJjZXM6IFtsb2FkdGVzdHNmbi5zdGF0ZU1hY2hpbmVBcm5dXG4gICAgfSkpXG5cbiAgICBjb25zdCBjd1J1bGUgPSBuZXcgUnVsZSh0aGlzLCBcImN3LXJ1bGVcIiwge1xuICAgICAgZGVzY3JpcHRpb246IFwiUnVsZSB0aGF0IGxvb2tzIGF0IEVDUyBUYXNrIGNoYW5nZSBzdGF0ZSBhbmQgdHJpZ2dlcnMgTGFtYmRhIGZ1bmN0aW9uXCIsXG4gICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgcnVsZU5hbWU6IFwiRUNTLXRhc2stY2hhbmdlLWNka1wiLFxuICAgICAgdGFyZ2V0czogW1xuICAgICAgXVxuICAgIH0pXG5cbiAgICBjd1J1bGUuYWRkRXZlbnRQYXR0ZXJuKHtcbiAgICAgIHNvdXJjZTogWydhd3MuZWNzJ10sXG4gICAgICBkZXRhaWxUeXBlOiBbXCJFQ1MgVGFzayBTdGF0ZSBDaGFuZ2VcIl0sXG4gICAgICBkZXRhaWw6IHtcbiAgICAgICAgY2x1c3RlckFybjogW2NsdXN0ZXIuY2x1c3RlckFybl0sXG4gICAgICAgIGxhc3RTdGF0dXM6IFtcIlNUT1BQRURcIl1cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY3dSdWxlLmFkZFRhcmdldChuZXcgdGFyZ2V0cy5MYW1iZGFGdW5jdGlvbihlY3NMYW1iZGEpKVxuXG4gIH1cbn1cbiJdfQ==